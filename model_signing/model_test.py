from pathlib import Path

import pytest

from model_signing.model import SigstoreSigner
# from sigstore.oidc import IdentityToken

@pytest.fixture
def staging_signer(monkeypatch) -> SigstoreSigner:
    return SigstoreSigner(disable_ambient=True,staging=True)


class TestModelSigner:
    @pytest.mark.integration
    def test_sign_model(self, staging_signer):
        #monkeypatch.setattr(staging_signer, "get_identity_token", lambda: IdentityToken("eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ikh5cTROQVRBanNucUM3bWRydEFoaHJDUjJfUSIsImtpZCI6IjFGMkFCODM0MDRDMDhFQzlFQTBCQjk5REFFRDAyMTg2QjA5MURCRjQifQ.eyJqdGkiOiI5MGUwOWEwMy02YWM0LTQyZDgtOWNiNy00ZjE5MjA1MjYxOTMiLCJzdWIiOiJyZXBvOnNpZ3N0b3JlLWNvbmZvcm1hbmNlL2V4dHJlbWVseS1kYW5nZXJvdXMtcHVibGljLW9pZGMtYmVhY29uOnJlZjpyZWZzL2hlYWRzL21haW4iLCJhdWQiOiJzaWdzdG9yZSIsInJlZiI6InJlZnMvaGVhZHMvbWFpbiIsInNoYSI6IjZmMTA5OWRlNjRkMTJhNDQ2NmVmOGNmMDE5MzFhOTM0NTBkM2ZlYzAiLCJyZXBvc2l0b3J5Ijoic2lnc3RvcmUtY29uZm9ybWFuY2UvZXh0cmVtZWx5LWRhbmdlcm91cy1wdWJsaWMtb2lkYy1iZWFjb24iLCJyZXBvc2l0b3J5X293bmVyIjoic2lnc3RvcmUtY29uZm9ybWFuY2UiLCJyZXBvc2l0b3J5X293bmVyX2lkIjoiMTMxODA0NTYzIiwicnVuX2lkIjoiOTY2OTA3MTQ5MSIsInJ1bl9udW1iZXIiOiIxMzM3OTIiLCJydW5fYXR0ZW1wdCI6IjEiLCJyZXBvc2l0b3J5X3Zpc2liaWxpdHkiOiJwdWJsaWMiLCJyZXBvc2l0b3J5X2lkIjoiNjMyNTk2ODk3IiwiYWN0b3JfaWQiOiI0MTg5ODI4MiIsImFjdG9yIjoiZ2l0aHViLWFjdGlvbnNbYm90XSIsIndvcmtmbG93IjoiRXh0cmVtZWx5IGRhbmdlcm91cyBPSURDIGJlYWNvbiIsImhlYWRfcmVmIjoiIiwiYmFzZV9yZWYiOiIiLCJldmVudF9uYW1lIjoid29ya2Zsb3dfZGlzcGF0Y2giLCJyZWZfcHJvdGVjdGVkIjoidHJ1ZSIsInJlZl90eXBlIjoiYnJhbmNoIiwid29ya2Zsb3dfcmVmIjoic2lnc3RvcmUtY29uZm9ybWFuY2UvZXh0cmVtZWx5LWRhbmdlcm91cy1wdWJsaWMtb2lkYy1iZWFjb24vLmdpdGh1Yi93b3JrZmxvd3MvZXh0cmVtZWx5LWRhbmdlcm91cy1vaWRjLWJlYWNvbi55bWxAcmVmcy9oZWFkcy9tYWluIiwid29ya2Zsb3dfc2hhIjoiNmYxMDk5ZGU2NGQxMmE0NDY2ZWY4Y2YwMTkzMWE5MzQ1MGQzZmVjMCIsImpvYl93b3JrZmxvd19yZWYiOiJzaWdzdG9yZS1jb25mb3JtYW5jZS9leHRyZW1lbHktZGFuZ2Vyb3VzLXB1YmxpYy1vaWRjLWJlYWNvbi8uZ2l0aHViL3dvcmtmbG93cy9leHRyZW1lbHktZGFuZ2Vyb3VzLW9pZGMtYmVhY29uLnltbEByZWZzL2hlYWRzL21haW4iLCJqb2Jfd29ya2Zsb3dfc2hhIjoiNmYxMDk5ZGU2NGQxMmE0NDY2ZWY4Y2YwMTkzMWE5MzQ1MGQzZmVjMCIsInJ1bm5lcl9lbnZpcm9ubWVudCI6ImdpdGh1Yi1ob3N0ZWQiLCJpc3MiOiJodHRwczovL3Rva2VuLmFjdGlvbnMuZ2l0aHVidXNlcmNvbnRlbnQuY29tIiwibmJmIjoxNzE5MzQ2Mjg0LCJleHAiOjE3MTkzNDcxODQsImlhdCI6MTcxOTM0Njg4NH0.M8jHDW2vtxdb2CJ6Phne7KjS2f1hHl3k0F4h1_1NpoipqB5Rc9e2jta_mUPg6x58jxv49PWv7MnoOq0FkSFY5_6ECVwW_NuvzLcXjm3gFhl00ug40frfA4TxK27QdE-_FWV7JQK1pt7Vu-JvzGs3Qbpg3xTB9HCQtl3YCoiyPU53q5LEYMpus3ZEjbBeVVvaeKqcelTgLDM08XCEu9qqZhk67g2K9vG9h1faFbkE2vm2yWI9apXobfhoC0VDKE5m-Up30ur9yW16dqDC5N7emg6R8i-FZqcMFYA-cTooQh3F08FjSjlA6X28SEusOmz1m9ZGC112s48P0UueHjnW4w"))
        staging_signer.sign(
            inputfn=Path("README.md"),
            signaturefn=Path("README.md.sig"),
            ignorepaths=[],
        )
